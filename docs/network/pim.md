---
title: "PIM"
layout: default
parent: Network
has_children: false
---

## 基本信息

- PIMv2 直接采用IP封装，组播地址224.0.0.13协议号103
- PIM-DM（dense mod） 密集组播网络
- PIM-SM 组成员稀疏的模式
- RPT 汇聚点树，以RP（Rendezvous Point）为根，组播成员为叶子组成的分发树（在SM和DM都有）
- SPT 组播分发树，以组播源为根，组播成员为叶子的分发树（在SM中）

- 组播路由表项：
    - （S，G）路由表项主要在PIM网络中建立SPT，老化时间210秒，老化时间内没有收到新的组播报文则删除表项
    - （*，G）路由表项主要在PIM网络中建立RPT

- PIM-DM的主要报文类型
    - Hello 邻居发现，协议参数协商（比如是dm还是sm模式），邻居关系维护（间隔为30秒，邻居hold time超时时间为105秒）
    - Jion/Prune （加入报文和剪枝报文）查询剪枝或加入周期是210秒
    - Graft（嫁接） 用于将设备所在的分支嫁接到组播分发树,单播报文
    - Graft-Ack(嫁接确认) 队Graft报文进行确认
    - Assert（断言） 用于断言机制，路由器对上层路由器多个数据之间选择一个路由器（周期时间是180秒，180秒后会再次选举）
        - 单播路由协议优先级高的
        - 如果优先级相同，则到组播源开销小的
        - 如果以上两则都相同，则选择ip地址大的
    - State Refresh为了避免被剪枝的接口因为剪枝定时器超时而恢复转发（210秒的超时），离组播源最近一跳路由器会周期的发送State Refresh报文（60秒周期），收到这个报文的PIM路由器会刷新剪枝定时器的状态，这样被剪枝的接口下游子路由器如果一致没有组成员加入则该接口一直处于抑制状态
- RPF检测：通过单播路由表检查是否存在环路，检查通过下发（S,G）表项